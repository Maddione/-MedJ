{% extends "basetemplates/base.html" %}
{% load static i18n %}

{% block nav_buttons %}
<div class="flex items-center gap-2 md:gap-4 lg:gap-6">
  {% with request.resolver_match.url_name as url_name %}
  <a href="{% url 'medj:dashboard' %}" class="px-3 md:px-5 py-2 font-bold uppercase tracking-wide rounded-full transition-colors {% if url_name == 'dashboard' %}bg-blockbg text-primaryDark shadow-md{% else %}text-white hover:bg-white/20{% endif %}">{% trans "Табло" %}</a>
  <a href="{% url 'medj:casefiles' %}" class="px-3 md:px-5 py-2 font-bold uppercase tracking-wide rounded-full transition-colors {% if url_name == 'casefiles' or 'event' in url_name %}bg-blockbg text-primaryDark shadow-md{% else %}text-white hover:bg-white/20{% endif %}">{% trans "Досие" %}</a>
  <a href="{% url 'medj:personalcard' %}" class="px-3 md:px-5 py-2 font-bold uppercase tracking-wide rounded-full transition-colors {% if url_name == 'personalcard' %}bg-blockbg text-primaryDark shadow-md{% else %}text-white hover:bg-white/20{% endif %}">{% trans "Л.Картон" %}</a>
  <a href="{% url 'medj:documents' %}" class="px-3 md:px-5 py-2 font-bold uppercase tracking-wide rounded-full transition-colors {% if 'document' in url_name or url_name == 'documents' %}bg-blockbg text-primaryDark shadow-md{% else %}text-white hover:bg-white/20{% endif %}">{% trans "Документи" %}</a>
  {% endwith %}
</div>
{% endblock %}

{% block nav_user %}
{% if user.is_authenticated %}
<div class="relative" id="userMenuWrap">
  <button id="userMenuBtn" class="flex items-center justify-center p-2">
    <img src="{% static 'images/profileicon.png' %}" alt="profile" class="h-7 w-7">
  </button>
  <div id="userMenu" class="hidden absolute top-full right-0 mt-2 w-64 z-50 rounded-xl shadow-lg bg-white p-2">
    <div class="px-3 py-2 text-sm text-gray-700 border-b border-gray-200">
      <p class="font-semibold">{% trans "Профил" %}</p>
      <p class="truncate text-gray-500">{{ user.email|default:user.username }}</p>
    </div>
    <nav class="mt-2 text-primaryDark">
      <a href="{% url 'medj:upload' %}" class="block px-3 py-2 rounded-lg hover:bg-sitebg font-semibold">{% trans "Качи документ" %}</a>
      <a href="{% url 'medj:documents' %}" class="block px-3 py-2 rounded-lg hover:bg-sitebg">{% trans "История" %}</a>
      <a href="{% url 'medj:share_history_page' %}" class="block px-3 py-2 rounded-lg hover:bg-sitebg">{% trans "Споделяния" %}</a>
      <a href="{% url 'medj:doctors' %}" class="block px-3 py-2 rounded-lg hover:bg-sitebg">{% trans "Лекари" %}</a>
      <a href="{% url 'medj:labtests' %}" class="block px-3 py-2 rounded-lg hover:bg-sitebg">{% trans "Изследвания" %}</a>
      <div class="my-2 border-t border-gray-200"></div>
      <a href="{% url 'medj:profile' %}" class="block px-3 py-2 rounded-lg hover:bg-sitebg">{% trans "Настройки" %}</a>
      <a href="{% url 'medj:password_change' %}" class="block px-3 py-2 rounded-lg hover:bg-sitebg">{% trans "Смяна на парола" %}</a>
      <div class="my-2 border-t border-gray-200"></div>
      <form method="post" action="{% url 'medj:logout' %}">
        {% csrf_token %}
        <button class="w-full text-left px-3 py-2 rounded-lg text-red-600 hover:bg-red-50">{% trans "Изход" %}</button>
      </form>
    </nav>
  </div>
</div>
{% endif %}
{% endblock %}

{% block body_content %}
<div class="w-[98%] mx-auto bg-blockbg rounded-3xl shadow-md flex-grow p-4 sm:p-6 lg:p-8">
  {% block app_content %}{% endblock %}
</div>
{% endblock %}

{% block scripts_extra %}
<script src="{% static 'js/onboarding_tour.js' %}?v={% now "U" %}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const userMenuBtn = document.getElementById('userMenuBtn');
  const userMenu = document.getElementById('userMenu');
  if (userMenuBtn && userMenu) {
    userMenuBtn.addEventListener('click', function(e) {
      e.stopPropagation(); userMenu.classList.toggle('hidden');
    });
    document.addEventListener('click', function(e) {
      if (!userMenu.contains(e.target) && !userMenuBtn.contains(e.target)) userMenu.classList.add('hidden');
    });
  }
});
</script>
{% endblock %}
