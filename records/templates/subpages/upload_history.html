{% extends "basetemplates/base_app.html" %}
{% load i18n static date_formats %}

{% block title %}{% trans "История на качванията" %}{% endblock %}

{% block app_content %}
<div class="max-w-7xl mx-auto px-4 py-8">
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-bold">{% trans "История на документи" %}</h1>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-4 gap-3 mb-6">
    <select id="filter_category" class="ui-select h-11 rounded-xl px-3 border border-gray-300">
      <option value="">{% trans "Категория" %}</option>
      {% for o in categories %}
      <option value="{{ o.id }}" {% if sel_category|default:'' == o.id|stringformat:'s' %}selected{% endif %}>{{ o.name }}</option>
      {% endfor %}
    </select>
    <select id="filter_specialty" class="ui-select h-11 rounded-xl px-3 border border-gray-300">
      <option value="">{% trans "Специалност" %}</option>
      {% for o in specialties %}
      <option value="{{ o.id }}" {% if sel_specialty|default:'' == o.id|stringformat:'s' %}selected{% endif %}>{{ o.name }}</option>
      {% endfor %}
    </select>
    <select id="filter_doc_type" class="ui-select h-11 rounded-xl px-3 border border-gray-300">
      <option value="">{% trans "Вид документ" %}</option>
      {% for o in doc_types %}
      <option value="{{ o.id }}" {% if sel_doc_type|default:'' == o.id|stringformat:'s' %}selected{% endif %}>{{ o.name }}</option>
      {% endfor %}
    </select>
    <select id="filter_tag" class="ui-select h-11 rounded-xl px-3 border border-gray-300">
      <option value="">{% trans "Таг" %}</option>
      {% for o in tags %}
      <option value="{{ o.id }}" {% if sel_tag|default:'' == o.id|stringformat:'s' %}selected{% endif %}>{{ o.safe_translation_getter:'name' }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="bg-white/70 rounded-2xl p-4 border border-gray-200">
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead class="text-left">
          <tr class="border-b">
            <th class="py-2 pr-4">{% trans "Дата" %}</th>
            <th class="py-2 pr-4">{% trans "Категория" %}</th>
            <th class="py-2 pr-4">{% trans "Специалност" %}</th>
            <th class="py-2 pr-4">{% trans "Вид" %}</th>
            <th class="py-2 pr-4">{% trans "Резюме" %}</th>
            <th class="py-2 pr-4"></th>
          </tr>
        </thead>
        <tbody>
          {% for d in documents %}
          <tr class="border-b hover:bg-black/5">
            <td class="py-2 pr-4">{{ d.uploaded_at|date:"d-m-Y" }}</td>
            <td class="py-2 pr-4">{{ d.category.safe_translation_getter:"name" }}</td>
            <td class="py-2 pr-4">{{ d.specialty.safe_translation_getter:"name" }}</td>
            <td class="py-2 pr-4">{{ d.doc_type.safe_translation_getter:"name" }}</td>
            <td class="py-2 pr-4">{{ d.summary|default:"" }}</td>
            <td class="py-2 pr-4">
              <a href="{% url 'medj:document_detail' d.id %}" class="underline">{% trans "Детайли" %}</a>
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="6" class="py-6 text-center opacity-70">{% trans "Няма документи" %}</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts_extra %}
<script src="{% static 'js/filters.js' %}"></script>
{% endblock %}
