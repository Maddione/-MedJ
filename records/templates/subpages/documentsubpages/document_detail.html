{% extends "basetemplates/base_app.html" %}
{% load i18n %}
{% block app_content %}
<div class="space-y-6">
  <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4">
    <div>
      <h1 class="text-3xl font-bold text-primaryDark">{{ document.display_title }}</h1>
      <p class="text-sm text-gray-500">{% trans "Документ" %} #{{ document.id }}</p>
    </div>
    <div class="flex flex-wrap gap-2">
      <a href="{% url 'medj:document_edit' document.id %}" class="px-4 py-2 rounded-lg bg-primary text-white">{% trans "Редакция" %}</a>
      <a href="{% url 'medj:document_edit_tags' document.id %}" class="px-4 py-2 rounded-lg bg-primaryDark text-white">{% trans "Тагове" %}</a>
      <a href="{% url 'medj:document_export_pdf' document.id %}" class="px-4 py-2 rounded-lg bg-success text-white">{% trans "Експорт PDF" %}</a>
    </div>
  </div>

  <div class="bg-blockbg p-5 rounded-2xl shadow">
    <div class="grid gap-4 md:grid-cols-2">
      <div>
        <div class="text-sm font-semibold text-gray-600">{% trans "Дата на документа" %}</div>
        <div class="text-lg text-primaryDark">{{ document.document_date|default_if_none:"—" }}</div>
      </div>
      <div>
        <div class="text-sm font-semibold text-gray-600">{% trans "Вид документ" %}</div>
        <div class="text-lg text-primaryDark">{{ document.doc_type }}</div>
      </div>
      <div>
        <div class="text-sm font-semibold text-gray-600">{% trans "Категория" %}</div>
        <div class="text-lg text-primaryDark">{{ document.category }}</div>
      </div>
      <div>
        <div class="text-sm font-semibold text-gray-600">{% trans "Събитие" %}</div>
        <div class="text-lg text-primaryDark">{{ document.medical_event|default_if_none:"—" }}</div>
      </div>
    </div>
  </div>

  <div class="bg-white p-5 rounded-2xl shadow space-y-6">
    <div>
      <h2 class="text-xl font-semibold text-primaryDark mb-3">{% trans "Анализ – таблица" %}</h2>
      {% if document.analysis_html %}
        <div class="rounded-2xl p-4 bg-white border">{{ document.analysis_html|safe }}</div>
      {% else %}
        <div class="text-gray-500">{% trans "Няма налична таблица от анализа." %}</div>
      {% endif %}
    </div>

    {% if document.analysis_text %}
      <div>
        <h2 class="text-xl font-semibold text-primaryDark mb-3">{% trans "Анализ – текст" %}</h2>
        <button id="toggle-analysis" class="px-4 py-2 rounded-lg bg-primary text-white">{% trans "Виж анализа в текстов вид" %}</button>
        <pre id="analysis-box" class="whitespace-pre-wrap hidden mt-3">{{ document.analysis_text }}</pre>
      </div>
    {% endif %}

    {% if document.ocr_text %}
      <div>
        <h2 class="text-xl font-semibold text-primaryDark mb-3">{% trans "OCR" %}</h2>
        <button id="toggle-ocr" class="px-4 py-2 rounded-lg bg-primary text-white">Виж оригинален OCR текст</button>
        <pre id="ocr-box" class="whitespace-pre-wrap hidden mt-3">{{ document.ocr_text }}</pre>
      </div>
    {% endif %}
  </div>
</div>
<script>
  (function(){
    var btn=document.getElementById('toggle-ocr');
    if(btn){
      btn.addEventListener('click',function(){
        var box=document.getElementById('ocr-box');
        if(!box){return;}
        box.classList.toggle('hidden');
      });
    }
    var abtn=document.getElementById('toggle-analysis');
    if(abtn){
      abtn.addEventListener('click',function(){
        var abox=document.getElementById('analysis-box');
        if(!abox){return;}
        abox.classList.toggle('hidden');
      });
    }
  })();
</script>
{% endblock %}
