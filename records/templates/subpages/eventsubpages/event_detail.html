{% extends 'basetemplates/base_app.html' %}
{% load static %}
{% load i18n %}
{% load medj_filters %}

{% block app_content %}
<main class="bg-site-background min-h-screen p-4 md:p-8">
    <div class="container mx-auto max-w-7xl">
        <div class="bg-block-background p-6 rounded-3xl shadow-lg mb-8">
            <h1 class="text-3xl font-bold text-gray-800">
                {% trans "Детайли за събитие" %}
            </h1>
            <p class="mt-2 text-gray-600">
                {% trans "Преглед и управление на медицинското събитие и свързаните с него документи." %}
            </p>
        </div>

        <div class="bg-block-background p-6 rounded-3xl shadow-lg mb-8">
            <h2 class="text-2xl font-bold text-navbar-button-blue mb-6">{% trans "Основна информация" %}</h2>
            <ul class="space-y-3 text-gray-700">
                <li><strong>{% trans "Дата:" %}</strong> {{ medical_event.event_date|date:"d-m-Y" }}</li>
                <li><strong>{% trans "Тип:" %}</strong> {{ medical_event.get_event_type_title_display }}</li>
                <li><strong>{% trans "Категория:" %}</strong> {{ medical_event.display_categories }}</li>
                <li><strong>{% trans "Специалност:" %}</strong> {{ medical_event.specialty.name }}</li>
            </ul>
        </div>

        <div class="bg-block-background p-6 rounded-3xl shadow-lg mb-8">
            <h2 class="text-2xl font-bold text-navbar-button-blue mb-6">{% trans "Резюме" %}</h2>
            <p class="text-gray-700">{{ medical_event.summary|default:_("Няма налично резюме.") }}</p>
        </div>

        <div class="bg-block-background p-6 rounded-3xl shadow-lg mb-8">
            <h2 class="text-2xl font-bold text-navbar-button-blue mb-6">{% trans "Документи" %}</h2>
            <div class="overflow-x-auto rounded-2xl border border-gray-200">
                <table class="min-w-full text-left text-gray-700">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="px-4 py-2">{% trans "Име" %}</th>
                            <th class="px-4 py-2">{% trans "Тип" %}</th>
                            <th class="px-4 py-2">{% trans "Дата" %}</th>
                            <th class="px-4 py-2">{% trans "Действия" %}</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
                        {% for d in documents %}
                        <tr>
                            <td class="px-4 py-2">{{ d.file.name|cut:"documents/" }}</td>
                            <td class="px-4 py-2">{{ d.doc_type.name }}</td>
                            <td class="px-4 py-2">{{ d.document_date|date:"d-m-Y" }}</td>
                            <td class="px-4 py-2">
                                <a href="{{ d.file.url }}" target="_blank" class="text-checkmark-green hover:underline mr-2">
                                    <i class="fa-solid fa-download"></i>
                                </a>
                                <a href="{% url 'medj:document_export_pdf' d.id %}" target="_blank" class="text-error-red hover:underline">
                                    <i class="fa-solid fa-file-pdf"></i>
                                </a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="4" class="px-4 py-6 text-center text-gray-500">{% trans "Няма документи към това събитие." %}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</main>
{% endblock %}

{% block scripts_extra %}
{% load static %}
<script src="{% static 'js/event_detail_logic.js' %}" defer></script>
{% endblock %}
