{% extends 'basetemplates/base_app.html' %}
{% load static %}
{% load i18n %}

{% block content %}
<main class="bg-site-background min-h-screen p-4 md:p-8">
  <div class="container mx-auto max-w-7xl">
    <div class="bg-block-background p-6 rounded-3xl shadow-lg mb-8">
      <h1 class="text-3xl font-bold text-gray-800">{% trans "Лабораторни показатели" %}</h1>
      <p class="mt-2 text-gray-600">{% trans "Визуализация на кръвни изследвания и други показатели." %}</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
      <div class="lg:col-span-1 bg-block-background p-6 rounded-3xl shadow-lg">
        <div class="mb-6">
          <button id="btnSave" class="w-full px-6 py-3 bg-checkmark-green text-white font-bold rounded-lg shadow-md hover:bg-green-700 transition-colors">
            {% trans "ЗАПИШИ" %}
          </button>
        </div>

        <form id="csvForm" method="get" action="{% url 'medj:export_lab_csv' %}" class="space-y-6">
          {% if medical_event %}
            <input type="hidden" name="event" value="{{ medical_event.id }}">
          {% endif %}
          <input type="hidden" name="codes" id="codesInput">

          <div class="bg-button-blue text-white p-4 rounded-3xl">
            <h3 class="text-lg font-semibold mb-3">{% trans "Филтър по дата" %}</h3>
            <div class="space-y-3">
              <div>
                <label class="block text-sm mb-1">{% trans "От" %}</label>
                <input type="date" name="from" class="w-full p-2 rounded-lg text-gray-900">
              </div>
              <div>
                <label class="block text-sm mb-1">{% trans "До" %}</label>
                <input type="date" name="to" class="w-full p-2 rounded-lg text-gray-900">
              </div>
            </div>
          </div>

          <div>
            <h3 class="text-lg font-semibold text-gray-700 mb-3">{% trans "Показатели" %}</h3>
            <div class="space-y-2">
              <label class="flex items-center space-x-2 text-gray-700">
                <input type="checkbox" class="form-checkbox indicator" data-code="TSH">
                <span class="w-4 h-4 rounded-full bg-blue-500 flex-shrink-0"></span>
                <span>TSH</span>
              </label>
              <label class="flex items-center space-x-2 text-gray-700">
                <input type="checkbox" class="form-checkbox indicator" data-code="T4">
                <span class="w-4 h-4 rounded-full bg-pink-500 flex-shrink-0"></span>
                <span>T4</span>
              </label>
              <label class="flex items-center space-x-2 text-gray-700">
                <input type="checkbox" class="form-checkbox indicator" data-code="MCHC">
                <span class="w-4 h-4 rounded-full bg-yellow-500 flex-shrink-0"></span>
                <span>MCHC</span>
              </label>
              <label class="flex items-center space-x-2 text-gray-700">
                <input type="checkbox" class="form-checkbox indicator" data-code="INSULIN">
                <span class="w-4 h-4 rounded-full bg-purple-600 flex-shrink-0"></span>
                <span>{% trans "Инсулин" %}</span>
              </label>
            </div>
          </div>

          <div class="space-y-3">
            <button type="submit" id="btnCsv" class="w-full px-6 py-3 bg-button-blue text-white font-bold rounded-lg shadow-md hover:bg-navbar-button-blue transition-colors">
              {% trans "Експорт CSV" %}
            </button>
          </div>
        </form>
      </div>

      <div class="lg:col-span-3 bg-block-background p-6 rounded-3xl shadow-lg">
        <div class="bg-navbar-button-blue text-white p-4 rounded-t-3xl -mx-6 -mt-6 mb-4">
          <h2 class="text-xl font-semibold">{% trans "Графика на показателите" %}</h2>
        </div>
        <div class="overflow-x-auto">
          <div class="w-full h-96 bg-gray-100 rounded-lg shadow-inner flex items-center justify-center text-gray-500 text-center">
            {% trans "Тук ще се появи интерактивна графика." %}
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<script>
document.getElementById('csvForm').addEventListener('submit', function(e){
  const codes = Array.from(document.querySelectorAll('.indicator:checked')).map(i => i.getAttribute('data-code'));
  document.getElementById('codesInput').value = codes.join(',');
});
</script>
{% endblock %}
