{% extends "basetemplates/base_app.html" %}
{% load i18n %}

{% block app_content %}
<div class="max-w-4xl mx-auto">

  <div class="bg-blockbg rounded-2xl p-6 shadow-sm mb-6">
    <div class="text-primaryDark text-2xl font-bold">{% trans "Споделено досие" %}</div>
    <div class="text-primaryDark opacity-70 mt-1">
      {% if event %}{% trans "Събитие" %} #{{ event.id }}{% endif %}
      {% if document %} · {% trans "Документ" %} #{{ document.id }}{% endif %}
      · {{ share.scope|default:"full" }}
    </div>
  </div>

  {% if need_password %}
  <div class="bg-blockbg rounded-2xl p-6 shadow-sm">
    <form method="post" action=".">
      {% csrf_token %}
      <div class="text-primaryDark font-semibold mb-2">{% trans "Въведете парола за достъп" %}</div>
      <input type="password" name="password" class="w-full h-11 rounded-xl px-4 border border-gray-300" placeholder="{% trans 'Парола' %}">
      {% if wrong_password %}
      <div class="mt-2 text-sm" style="color:#D84137">{% trans "Невалидна парола." %}</div>
      {% endif %}
      <div class="mt-4">
        <button class="px-4 h-11 rounded-xl text-white" style="background:#43B8CF">{% trans "Потвърди" %}</button>
      </div>
    </form>
  </div>
  {% else %}

  {% if event %}
  <div class="bg-blockbg rounded-2xl p-4 shadow-sm mb-4">
    <div class="text-primaryDark font-semibold mb-2">{% trans "Събитие" %}</div>
    <div class="text-primaryDark">{% trans "Дата" %}: {{ event.event_date|date:"d-m-Y" }}</div>
    <div class="text-primaryDark">{% trans "Специалност" %}: {{ event.specialty.name }}</div>
  </div>
  {% endif %}

  {% if document and scope != "labs" %}
  <div class="bg-blockbg rounded-2xl p-4 shadow-sm mb-4">
    <div class="text-primaryDark font-semibold mb-2">{% trans "Резюме" %}</div>
    <div class="text-primaryDark">{{ document.summary|default:_("Няма резюме") }}</div>
    <div class="text-primaryDark mt-2">{% trans "Дата" %}: {{ document.date_created|date:"d-m-Y" }}</div>
    <div class="mt-3">
      <a href="{{ document.file.url }}" target="_blank" class="inline-flex items-center px-3 py-2 rounded-lg text-white" style="background:#43B8CF">{% trans "Изтегли файла" %}</a>
    </div>
  </div>
  {% endif %}

  {% if event and (scope == "full" or scope == "labs") %}
  <div class="bg-blockbg rounded-2xl p-4 shadow-sm">
    <div class="text-primaryDark font-semibold mb-3">{% trans "Лабораторни резултати" %}</div>
    {% if labs %}
    <div class="overflow-x-auto rounded-2xl border border-gray-200">
      <table class="min-w-full text-left text-primaryDark">
        <thead class="bg-white">
          <tr>
            <th class="px-4 py-2">{% trans "Показател" %}</th>
            <th class="px-4 py-2">{% trans "Стойност" %}</th>
            <th class="px-4 py-2">{% trans "Единица" %}</th>
            <th class="px-4 py-2">{% trans "Реф. ниска" %}</th>
            <th class="px-4 py-2">{% trans "Реф. висока" %}</th>
            <th class="px-4 py-2">{% trans "Дата" %}</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
          {% for m in labs %}
          <tr>
            <td class="px-4 py-2">{{ m.indicator.name }}</td>
            <td class="px-4 py-2">{{ m.value }}</td>
            <td class="px-4 py-2">{{ m.indicator.unit }}</td>
            <td class="px-4 py-2">{{ m.indicator.reference_low }}</td>
            <td class="px-4 py-2">{{ m.indicator.reference_high }}</td>
            <td class="px-4 py-2">{{ m.measured_at|date:"d-m-Y" }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="text-primaryDark opacity-70">{% trans "Няма лабораторни данни." %}</div>
    {% endif %}
  </div>
  {% endif %}

  {% endif %}
</div>
{% endblock %}
