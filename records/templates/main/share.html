{% extends "basetemplates/base_app.html" %}
{% load i18n %}
{% block title %}{% trans "Споделяне / Експорт" %}{% endblock %}
{% block app_content %}
<main class="max-w-6xl mx-auto grid md:grid-cols-12 gap-6">
  <section class="md:col-span-8 bg-blockalt rounded-2xl shadow p-4">
    <h1 class="text-2xl font-bold mb-3" style="color:#0A4E75">{% trans "Филтър" %}</h1>
    <form id="share-filters" class="space-y-4" data-create-links-url="{% url 'medj:create_download_links' %}" data-qr-for-url="{% url 'medj:qr_for_url' %}">
      {% csrf_token %}
      <div class="grid sm:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-semibold mb-1" style="color:#0A4E75">{% trans "От дата" %}</label>
          <input type="date" name="start_date" class="w-full rounded-lg p-2 border border-gray-300 bg-white text-[#0A4E75]">
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1" style="color:#0A4E75">{% trans "До дата" %}</label>
          <input type="date" name="end_date" class="w-full rounded-lg p-2 border border-gray-300 bg-white text-[#0A4E75]">
        </div>
      </div>
      <div class="grid sm:grid-cols-3 gap-4">
        <div>
          <label class="block text-sm font-semibold mb-1" style="color:#0A4E75">{% trans "Валидност PDF събития (часове)" %}</label>
          <input type="number" min="1" max="8760" name="hours_events" value="24" class="w-full rounded-lg p-2 border border-gray-300 bg-white text-[#0A4E75]">
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1" style="color:#0A4E75">{% trans "Валидност PDF лаборатории (часове)" %}</label>
          <input type="number" min="1" max="8760" name="hours_labs" value="24" class="w-full rounded-lg p-2 border border-gray-300 bg-white text-[#0A4E75]">
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1" style="color:#0A4E75">{% trans "Валидност CSV (часове)" %}</label>
          <input type="number" min="1" max="8760" name="hours_csv" value="24" class="w-full rounded-lg p-2 border border-gray-300 bg-white text-[#0A4E75]">
        </div>
      </div>
      {% if specialty_options or category_options %}
      <div class="grid sm:grid-cols-2 gap-4">
        {% if specialty_options %}
        <div>
          <span class="block text-sm font-semibold mb-2" style="color:#0A4E75">{% trans "Специалности" %}</span>
          <div class="flex flex-wrap gap-2">
            {% for item in specialty_options %}
            <label class="inline-flex items-center gap-2 bg-white border border-gray-200 px-3 py-1 rounded-full text-sm text-[#0A4E75]">
              <input type="checkbox" name="specialty" value="{{ item.id }}" class="rounded border-gray-300 text-[#0A4E75] focus:ring-[#0A4E75]">
              <span>{{ item.name }}</span>
            </label>
            {% endfor %}
          </div>
        </div>
        {% endif %}
        {% if category_options %}
        <div>
          <span class="block text-sm font-semibold mb-2" style="color:#0A4E75">{% trans "Категории" %}</span>
          <div class="flex flex-wrap gap-2">
            {% for item in category_options %}
            <label class="inline-flex items-center gap-2 bg-white border border-gray-200 px-3 py-1 rounded-full text-sm text-[#0A4E75]">
              <input type="checkbox" name="category" value="{{ item.id }}" class="rounded border-gray-300 text-[#0A4E75] focus:ring-[#0A4E75]">
              <span>{{ item.name }}</span>
            </label>
            {% endfor %}
          </div>
        </div>
        {% endif %}
      </div>
      {% endif %}
      {% if event_options %}
      <div>
        <label class="block text-sm font-semibold mb-1" style="color:#0A4E75">{% trans "Събития" %}</label>
        <select name="event" multiple size="5" class="w-full rounded-lg border border-gray-300 bg-white text-[#0A4E75] p-2">
          {% for item in event_options %}
          <option value="{{ item.id }}">{{ item.label }}</option>
          {% endfor %}
        </select>
        <p class="text-xs text-gray-500 mt-1">{% trans "Изберете едно или повече събития (задръжте Ctrl/Command за множество)." %}</p>
      </div>
      {% endif %}
      {% if indicator_options %}
      <div>
        <span class="block text-sm font-semibold mb-2" style="color:#0A4E75">{% trans "Лабораторни показатели" %}</span>
        <div class="flex flex-wrap gap-2">
          {% for item in indicator_options %}
          <label class="inline-flex items-center gap-2 bg-white border border-gray-200 px-3 py-1 rounded-full text-sm text-[#0A4E75]">
            <input type="checkbox" name="indicator" value="{{ item.slug }}" class="rounded border-gray-300 text-[#0A4E75] focus:ring-[#0A4E75]">
            <span>{{ item.name }}</span>
          </label>
          {% endfor %}
        </div>
      </div>
      {% endif %}
      <div class="flex items-center gap-6 mt-2">
        <label class="inline-flex items-center gap-2"><input id="generate-events" name="generate_events" type="checkbox" class="w-4 h-4" value="1" checked><span>{% trans "PDF събития" %}</span></label>
        <label class="inline-flex items-center gap-2"><input id="generate-labs" name="generate_labs" type="checkbox" class="w-4 h-4" value="1" checked><span>{% trans "PDF лаборатории" %}</span></label>
        <label class="inline-flex items-center gap-2"><input id="generate-csv" name="generate_csv" type="checkbox" class="w-4 h-4" value="1" checked><span>CSV</span></label>
      </div>
      <div class="mt-4">
        <button type="button" id="gen-links" class="px-4 py-2 rounded-xl bg-primary text-blockalt">{% trans "Приложи филтри" %}</button>
      </div>
    </form>
  </section>
  <section class="md:col-span-4 bg-blockalt rounded-2xl shadow p-4">
    <h2 class="text-xl font-semibold mb-3" style="color:#0A4E75">{% trans "Резултат" %}</h2>
    <div id="results-summary" class="text-sm text-gray-600 mb-4">{% trans "Изберете филтри и натиснете „Приложи филтри“, за да получите линкове." %}</div>
    <div class="space-y-3">
      <div>
        <label class="text-sm font-semibold block mb-1">{% trans "PDF събития" %}</label>
        <input id="link-pdf-events" type="text" readonly class="w-full rounded-lg p-2 border border-gray-300 bg-white text-[#0A4E75]">
        <a id="btn-pdf-events" class="inline-block mt-2 px-3 py-1 rounded-lg bg-[#0A4E75] text-white opacity-50 pointer-events-none" target="_blank">{% trans "Отвори" %}</a>
      </div>
      <div>
        <label class="text-sm font-semibold block mb-1">{% trans "PDF лаборатории" %}</label>
        <input id="link-pdf-labs" type="text" readonly class="w-full rounded-lg p-2 border border-gray-300 bg-white text-[#0A4E75]">
        <a id="btn-pdf-labs" class="inline-block mt-2 px-3 py-1 rounded-lg bg-[#0A4E75] text-white opacity-50 pointer-events-none" target="_blank">{% trans "Отвори" %}</a>
      </div>
      <div>
        <label class="text-sm font-semibold block mb-1">CSV</label>
        <input id="link-csv" type="text" readonly class="w-full rounded-lg p-2 border border-gray-300 bg-white text-[#0A4E75]">
        <a id="btn-csv" class="inline-block mt-2 px-3 py-1 rounded-lg bg-[#0A4E75] text-white opacity-50 pointer-events-none" target="_blank">{% trans "Отвори" %}</a>
      </div>
      <div class="mt-4">
        <img id="qr-img" class="w-48 h-48 border rounded-lg" alt="{% trans 'QR код към последния генериран линк' %}">
      </div>
    </div>
    <div class="mt-4">
      <h3 class="text-sm font-semibold text-[#0A4E75] mb-2">{% trans "Документи за споделяне" %}</h3>
      <ul id="results-list" class="space-y-2"></ul>
    </div>
  </section>
</main>
{% endblock %}
{% block scripts_extra %}
{% load static %}
{{ block.super }}
<script src="{% static 'js/share_logic.js' %}?v=2"></script>
{% endblock %}
